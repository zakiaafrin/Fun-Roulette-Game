<?php
session_start();
// if (isset($_SESSION['block'])) {
//     header('Location: won.php');
// }
include("inc/connection.php");

$title= 'Fun Roulette Game';
$email = $_SESSION['email'];

if($email == TRUE) {
} else {
    header('location:login.php');
}

$query = "SELECT * FROM players WHERE email='$email'";                                                                                                                                     
$data = mysqli_query($conn, $query);
$total = mysqli_num_rows($data);

if($total !=0){
    while($result = mysqli_fetch_assoc($data)){
        $player = $result['username'];
        $coins = $result['chips'];
        }
    } else {
        echo "No record found";
} 

$query = "SELECT * FROM bet WHERE player_name='$player'";                                                                                                                                       
$data = mysqli_query($conn, $query);
$total = mysqli_num_rows($data); 

$winning_number = rand(0, 35);
$a = array("Red"=>"red","Green"=>"green","Black"=>"black");
$winning_color = (array_rand($a,1));

include "inc/header.php"; 
?>
<div class="head" id="main">
    <div class="menu">
        <div>
            <button class="head-btn" onclick="openNav()">☰</button>
        </div>
        <div>
            <button class="head-btn" style="margin-left: 88px;">
                <?php echo $title; ?></button>
        </div>
        <div class="wallet">
            <div><strong>
                    <?php echo $coins;  ?> chips </strong></div>
            <div><img src="img/coin.png" alt="coin" class="coin"></div>
        </div>

    </div>

    <div class="welcome">Welcome <b>
            <?php echo $player; ?></b> | <a href="logout.php">Logout</a></div>
</div>

<div id="mySidebar" class="sidebar">
    <img src="img/7.png" alt="Roulette Logo" class="logo">
    <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">×</a>
    <button class="side-btn"><a href="summary.php">Result</a></button>
    <button class="side-btn"><a href="help.php">Help</a></button>
    <button class="side-btn"><a href="store.php">Store</a></button>

    <div class="mail welcome">
        <?php echo $email; ?>
    </div>
</div>

<div style="text-align:center;">
    <div>
        <img src="img/results.png" alt="Result Logo" style="width: 525px; text-align:center;">
    </div>

    <div class="result-right">
        <?php 
if($total != 0){
    while($result = mysqli_fetch_assoc($data)){
        echo   " 
        <h3>You have bet " . $result['amount'] . " chips.</h3>
        <h3 id='sub'>Your Number : " . $result['number'] . "</h3>
        <h3 id='sub'>Your Color : " . $result['color'] . "</h3>
    </div>
</div>
<div class='result-container'>
    <div class='result-left'>
        <h2>Winning Number : $winning_number</h2>
        <h2>Winning Color : $winning_color</h2>
    </div>
</div>
<div class='congrate'>"; 
        if (($result['number'] == $winning_number) && ($result['color'] == $winning_color)) {
            $win = ($result['amount']) * 20;
            echo "<h2>Congratulations!!! You have won " . $win . " chips.</h2>";
        }
        if (($result['number'] == $winning_number) && !($result['color'] == $winning_color)) {
            $win = ($result['amount']) * 10;
            echo "<h2>Congratulations!!! You have won " . $win . " chips.</h2>";
        }
        if (!($result['number'] == $winning_number) && ($result['color'] == $winning_color)) {
            $win = ($result['amount']) * 1.5;
            echo "<h2>Congratulations!!! You have won " . $win . " chips.</h2>";
        }
        if (!($result['number'] == $winning_number) && !($result['color'] == $winning_color)) 
        echo "<h2>Better luck next time.</h2>";
        }
    } else {
    // echo "No record found";
}
    ?>
                                        
</div>

<script>
    function openNav() {
        document.getElementById("mySidebar").style.width = "290px";
        document.getElementById("mySidebar").style.textAlign = "center";
        document.getElementById("main").style.marginLeft = "250px";
    }

    function closeNav() {
        document.getElementById("mySidebar").style.width = "0";
        document.getElementById("main").style.marginLeft = "0";
    }
</script>
<?php

// $query = "TRUNCATE TABLE bet;";
// if (mysqli_query($conn, $query)) {
//     // header('location:summary.php');
// } else {
//     echo "Error: " . $query . "<br>" . mysqli_error($conn);
// }

?>
<?php include "inc/footer.php"; ?>